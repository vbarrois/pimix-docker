!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=6)}([function(e,n,t){var o=t(7),r=t(8).Strategy,i=t(9),s=void 0!==process.env.DATAHOST?process.env.DATAHOST:"127.0.0.1:81";o.use(new r({usernameField:"login",passReqToCallback:!0,failureFlash:!0},(function(e,n,t,o){"1"===e.body.usermode?i.post("http://"+s+"/api/login",{login:n,password:t}).then((function(e){return e.data.connected?o(null,e.data.user):o(null,!1,{message:e.data.message})})).catch((function(e){return o(null,!1,{message:"Login directory not available"})})):i.post("http://"+s+"/api/pseudo",{login:n}).then((function(e){return e.data.connected?o(null,e.data.user):o(null,!1,{message:e.data.message})})).catch((function(e){return o(null,!1,{message:"Login directory not available"})}))}))),o.serializeUser((function(e,n){n(null,e)})),o.deserializeUser((function(e,n){n(null,e)})),e.exports=o},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("session-file-store")},function(e,n,t){"use strict";t.r(n);var o=t(4),r=t.n(o),i=t(1),s=t.n(i),u=t(0),a=t.n(u),l=t(2),c=t.n(l),f=t(3),p=t.n(f),d=t(5),g=t.n(d),m=t(10),x=g()(p.a);console.log("***************************************************"),console.log("Pimix SERVER is started in production mode"),console.log("***************************************************");var v=s()();v.use(s.a.static(__dirname));var b={store:new x({}),secret:"PiMiX",resave:!0,saveUninitialized:!0,name:"pimix-session",maxAge:Date.now()+2592e6};v.use(p()(b)),v.use(c.a.urlencoded({extended:!0})),v.use(c.a.json()),v.use(a.a.initialize()),v.use(a.a.session()),t(11)(v),v.get("/login",(function(e,n,t){h("login.html",n,t)})),v.get("/",m,(function(e,n,t){h("pimix.html",n,t)})),v.get("*",(function(e,n,t){n.status(404).end()}));var y=process.env.SERVERPORT||80;function h(e,n,t){n.set("content-type","text/html");var o=r.a.join(__dirname,e);n.sendFile(o)}v.listen(y,(function(){console.log("App listening to ".concat(y,"....")),console.log("Press Ctrl+C to quit.")}))},function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("axios")},function(e,n){e.exports=function(e,n,t){return e.user?t():n.redirect("/login")}},function(e,n,t){var o=t(0);e.exports=function(e){e.post("/api/login",(function(e,n,t){o.authenticate("local",(function(o,r,i){o&&n.status(500).send(o),r&&(e.login(r,{},(function(e){if(e)return t(e)})),console.log("User logged in ["+r.login+"]")),n.json({user:r,info:i})}))(e,n,t)})),e.get("/api/logout",(function(e,n){e.user&&console.log("User logged out ["+e.user.login+"]"),e.logout(),n.redirect("/")})),e.get("/api/user",(function(e,n){void 0===e.user?n.json({}):n.json(e.user)}))}}]);